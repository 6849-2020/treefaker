(function(e){function t(t){for(var r,i,s=t[0],c=t[1],d=t[2],f=0,u=[];f<s.length;f++)i=s[f],Object.prototype.hasOwnProperty.call(n,i)&&n[i]&&u.push(n[i][0]),n[i]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);l&&l(t);while(u.length)u.shift()();return o.push.apply(o,d||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],r=!0,s=1;s<a.length;s++){var c=a[s];0!==n[c]&&(r=!1)}r&&(o.splice(t--,1),e=i(i.s=a[0]))}return e}var r={},n={app:0},o=[];function i(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=r,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(a,r,function(t){return e[t]}.bind(null,r));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var d=0;d<s.length;d++)t(s[d]);var l=c;o.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("cd49")},1:function(e,t){},"65d9":function(e,t,a){e.exports=a.p+"img/TreeFakerLogo.4983e02e.svg"},6672:function(e,t,a){},cd49:function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d");var r=a("2b0e"),n=a("2f62"),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("TreeFaker")},i=[],s=a("d4ec"),c=a("262e"),d=a("2caf"),l=a("9ab4"),f=a("60a3"),u=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("b-navbar",{attrs:{type:"dark",variant:"dark"}},[r("b-navbar-nav",[r("b-navbar-brand",{attrs:{href:"#"}},[r("img",{staticClass:"logo",attrs:{src:a("65d9")}})]),r("b-nav-item-dropdown",{attrs:{text:"File",right:""}},[r("b-dropdown-item",{attrs:{href:"#",disabled:e.exportDisabled},on:{click:e.exportFold}},[e._v("Export to FOLD")])],1),r("b-nav-item",{directives:[{name:"b-modal",rawName:"v-b-modal.controlsPopover",modifiers:{controlsPopover:!0}}],attrs:{href:"#"}},[e._v("Controls")]),r("b-nav-item",{directives:[{name:"b-modal",rawName:"v-b-modal.aboutPopover",modifiers:{aboutPopover:!0}}],attrs:{href:"#"}},[e._v("About")])],1)],1),r("b-modal",{attrs:{id:"aboutPopover",title:"About",size:"lg","ok-only":""}},[r("p",{staticClass:"description"},[e._v("This tool was created by "),r("a",{attrs:{href:"https://pjrule.me/",target:"_blank"}},[e._v("Parker Rule")]),e._v(" and "),r("a",{attrs:{href:"http://www.jamie.tuckerfoltz.com/",target:"_blank"}},[e._v("Jamie Tucker-Foltz")]),e._v(" as a final project for "),r("a",{attrs:{href:"https://courses.csail.mit.edu/6.849/fall20/",target:"_blank"}},[e._v("6.849: Geometric Folding Algorithms")]),e._v(" (MIT), fall 2020.")]),r("p",{staticClass:"description"},[e._v("We are grateful for the guidance of Erik Demaine and Robert Lang, and we thank "),r("a",{attrs:{href:"https://tck.mn/",target:"_blank"}},[e._v("Andy Tockman")]),e._v(" for his contributions.")])]),r("b-modal",{attrs:{id:"controlsPopover",title:"Controls",size:"lg","ok-only":""}},[r("p",{staticClass:"description"},[e._v(" Welcome to TreeFaker, an online, lightweight version of Robert Lang's "),r("a",{attrs:{href:"https://langorigami.com/article/treemaker/",target:"_blank"}},[e._v("TreeMaker")]),e._v(". To get started: "),r("ol",[r("li",[e._v("Draw a tree in the left box. "),r("strong",[e._v("Ctrl + drag")]),e._v(" a vertex to add a new leaf to the tree. "),r("strong",[e._v("Alt + drag")]),e._v(" an edge to adjust the tree without changing edge lengths, or "),r("strong",[e._v("Alt + Ctrl + drag")]),e._v(" to fix the orientation of the subtree. "),r("strong",[e._v("Shift + click")]),e._v(" on an edge to delete it. "),r("strong",[e._v("Right click")]),e._v(" on an edge to manually set its length. Press "),r("strong",[e._v("Ctrl + Z")]),e._v(" or "),r("strong",[e._v("Ctrl + Y")]),e._v(" to undo or redo.")]),r("li",[e._v("When you are done drawing the tree, click "),r("strong",[e._v("Generate Disk Packing")]),e._v(".")]),r("li",[e._v("When you are satisfied with the disk packing, click "),r("strong",[e._v("Get Crease Pattern")]),e._v(".")]),r("li",[e._v("To export the crease pattern, click "),r("strong",[e._v("Open in Origami Simulator")]),e._v(" or "),r("strong",[e._v("File > Export FOLD")]),e._v(". "),r("em",[e._v("(As we have not fully implemented mountain/valley assignment, rendering in Origami Simulator may fail.)")])])])])]),r("div",{staticClass:"container"},[r("table",{staticClass:"views"},[r("tr",{staticClass:"threeViews"},[r("td",{staticClass:"viewBoxTd"},[r("TreeView",{ref:"tree"})],1),r("td",{staticClass:"spacer"}),r("td",{staticClass:"viewBoxTd"},[r("PackingView",{ref:"packing"})],1),r("td",{staticClass:"spacer"}),r("td",{staticClass:"viewBoxTd"},[r("CreasesView",{ref:"creases"})],1)]),r("tr",{staticClass:"threeButtons"},[r("td",[r("b-button",{attrs:{variant:"primary",size:"lg"},on:{click:e.generatePacking}},[r("b-spinner",{directives:[{name:"show",rawName:"v-show",value:e.generatingPacking,expression:"generatingPacking"}],attrs:{small:""}}),e._v(" Generate Disk Packing ")],1)],1),r("td"),r("td",[r("b-button",{attrs:{variant:"primary",size:"lg",disabled:e.creasesDisabled},on:{click:e.getCreasePattern}},[e._v(" Get Crease Pattern ")])],1),r("td"),r("td",[r("b-button",{attrs:{variant:"primary",size:"lg",disabled:e.exportDisabled},on:{click:e.origamiSimulator}},[e._v(" Open in Origami Simulator ")])],1)])]),r("input",{staticStyle:{display:"none"},attrs:{type:"text",id:"inputBox"}}),r("br"),r("b-alert",{attrs:{show:e.inErrorState,variant:"danger"}},[r("p",[e._v(e._s(e.errorMessage))])])],1)],1)},h=[],g=(a("96cf"),a("1da1")),v=a("bee2"),p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"viewBox",attrs:{id:"treeViewBox"}})},b=[],y=(a("4160"),a("a630"),a("d81d"),a("fb6a"),a("b0c0"),a("4ec9"),a("a9e3"),a("b680"),a("d3b7"),a("25f0"),a("6062"),a("3ca3"),a("159b"),a("ddb0"),a("b85c")),w=a("3835"),O=a("b424"),m=(a("99af"),a("c975"),a("a434"),1e-6),j=5*m,x=m/1024,k=-Math.PI-m,E=Math.PI-m,P=-2*Math.PI+m,F=2*Math.PI-m;function M(e){var t,a=Object(y["a"])(e);try{for(a.s();!(t=a.n()).done;){var r=t.value;return r}}catch(n){a.e(n)}finally{a.f()}throw new Error("Set is empty.")}function S(e,t){return e>t?t+"-"+e:e+"-"+t}var C,I,T=function(){function e(t,a,r){Object(s["a"])(this,e),this.id=t,this.x=a,this.y=r,this.edges=[]}return Object(v["a"])(e,[{key:"counterclockwise",value:function(e){var t=this.edges.indexOf(e);if(-1==t)throw new Error("Edge ".concat(e.from.id," -> ").concat(e.to.id," not adjacent to vertex ").concat(this.id,"."));var a=this.edges.length;return this.edges[(t+1)%a]}},{key:"clockwise",value:function(e){var t=this.edges.indexOf(e);if(-1==t)throw console.log(this),new Error("Edge ".concat(e.from.id," -> ").concat(e.to.id," not adjacent to vertex ").concat(this.id,"."));var a=this.edges.length;return this.edges[(t-1+a)%a]}}]),e}(),A=function(){function e(t,a){Object(s["a"])(this,e),this.to=t,this.from=a}return Object(v["a"])(e,[{key:"getOtherNode",value:function(e){if(e==this.to)return this.from;if(e==this.from)return this.to;throw new Error("Node not in edge.")}},{key:"idString",value:function(){return S(this.from.id,this.to.id)}}]),e}(),_=function(e){Object(c["a"])(a,e);var t=Object(d["a"])(a);function a(){return Object(s["a"])(this,a),t.apply(this,arguments)}return a}(T),N=function(e){Object(c["a"])(a,e);var t=Object(d["a"])(a);function a(e,r,n){var o;return Object(s["a"])(this,a),o=t.call(this,e,r),o.length=n,o}return a}(A),U=function(e){Object(c["a"])(a,e);var t=Object(d["a"])(a);function a(){return Object(s["a"])(this,a),t.apply(this,arguments)}return a}(T),R=function e(){Object(s["a"])(this,e),this.scaleFactor=0,this.nodes=new Map},G=function(e){Object(c["a"])(a,e);var t=Object(d["a"])(a);function a(e,r,n,o,i){var c;return Object(s["a"])(this,a),c=t.call(this,e,n,o),c.displayId=r,c.faces=[],c.onBoundaryOfSquare=n<m||o<m||n>1-m||o>1-m,c.goUpRidge=null,c.elevation=i,c.hasPseudohinge=!1,c}return a}(U);(function(e){e[e["Axial"]=0]="Axial",e[e["Gusset"]=1]="Gusset",e[e["Ridge"]=2]="Ridge",e[e["Hinge"]=3]="Hinge",e[e["Pseudohinge"]=4]="Pseudohinge",e[e["ActiveHull"]=5]="ActiveHull",e[e["InactiveHull"]=6]="InactiveHull"})(C||(C={})),function(e){e[e["Mountain"]=0]="Mountain",e[e["Valley"]=1]="Valley",e[e["Unfolded"]=2]="Unfolded",e[e["Unknown"]=3]="Unknown",e[e["Boundary"]=4]="Boundary"}(I||(I={}));var B,H=function(e){Object(c["a"])(a,e);var t=Object(d["a"])(a);function a(e,r,n,o){var i;return Object(s["a"])(this,a),i=t.call(this,e,r),i.baseFace=o,i.leftFace=null,i.rightFace=null,i.creaseType=C.Axial,i.assignment=I.Unknown,i.updateCreaseType(n),i}return Object(v["a"])(a,[{key:"updateCreaseType",value:function(e){this.creaseType=e,e==C.ActiveHull||e==C.InactiveHull?this.assignment=I.Boundary:e==C.Gusset||e==C.Pseudohinge?this.assignment=I.Valley:e==C.Ridge?this.assignment=I.Mountain:this.assignment=I.Unknown}},{key:"getOtherFace",value:function(e){if(e==this.leftFace)return this.rightFace;if(e==this.rightFace)return this.leftFace;throw new Error("Face not adjacent to edge.")}},{key:"sumElevations",value:function(){return this.from.elevation+this.to.elevation}}]),a}(A),L=function(){function e(){Object(s["a"])(this,e),this.isOuterFace=!1,this.nodes=[],this.inactiveHullCrease=null,this.crossRidge=null,this.crossGussetOrPseudohinge=null,this.crossAxialOrHull=null,this.hasPseudohinge=!1,this.extendedHasPseudohinge=!1,this.flap=new Set,this.corridor=null,this.creaseToNextAxialFacet=null,this.creaseToPreviousAxialFacet=null,this.facetOrderIndex=-1,this.isColored=!1,this.coloring=!1,this.baseFaceLocalRoot="unset",this.moleculeSource=null}return Object(v["a"])(e,[{key:"averageX",value:function(){var e,t=0,a=Object(y["a"])(this.nodes);try{for(a.s();!(e=a.n()).done;){var r=e.value;t+=r.x}}catch(n){a.e(n)}finally{a.f()}return t/this.nodes.length}},{key:"averageY",value:function(){var e,t=0,a=Object(y["a"])(this.nodes);try{for(a.s();!(e=a.n()).done;){var r=e.value;t+=r.y}}catch(n){a.e(n)}finally{a.f()}return t/this.nodes.length}}]),e}(),X=function(){function e(){Object(s["a"])(this,e),this.faces=new Set,this.adj=new Map}return Object(v["a"])(e,[{key:"addFace",value:function(e){this.faces.has(e)||(this.faces.add(e),this.adj.set(e,[]))}},{key:"addEdge",value:function(e,t){if(!this.faces.has(e))throw new Error("First face ".concat(e.nodes.map((function(e){return e.id}))," not in FacetOrderingGraph."));if(!this.faces.has(t))throw new Error("Second face ".concat(t.nodes.map((function(e){return e.id}))," not in FacetOrderingGraph."));var a=this.adj.get(e);a.push(t)}},{key:"topologicalSortHelper",value:function(e,t,a){var r=this;t.add(e);var n=this.adj.get(e);n.forEach((function(e){t.has(e)||r.topologicalSortHelper(e,t,a)})),a.push(e)}},{key:"topologicalSort",value:function(){var e=this,t=[],a=new Set;this.faces.forEach((function(r){a.has(r)||e.topologicalSortHelper(r,a,t)}));for(var r=new Set,n=0,o=t;n<o.length;n++){var i,s=o[n],c=Object(y["a"])(this.adj.get(s));try{for(c.s();!(i=c.n()).done;){var d=i.value;if(!r.has(d))throw new Error("Facet ordering graph is not a DAG: cycle involving faces ".concat(s.nodes.map((function(e){return e.id}))," and ").concat(d.nodes.map((function(e){return e.id})),"."))}}catch(l){c.e(l)}finally{c.f()}r.add(s)}return t.reverse()}}]),e}(),D=function(){function e(){Object(s["a"])(this,e),this.nodes=new Map,this.edges=new Map}return Object(v["a"])(e,[{key:"addNode",value:function(e){if(this.nodes.has(e.id))throw new Error("Node with ID ".concat(e.id," already exists."));this.nodes.set(e.id,e)}},{key:"addEdge",value:function(e){if(!this.nodes.has(e.from.id))throw new Error("Cannot add an edge from nonexistent node ".concat(e.from.id,"."));if(!this.nodes.has(e.to.id))throw new Error("Cannot add an edge to nonexistent node ".concat(e.to.id,"."));for(var t=Math.atan2(e.to.y-e.from.y,e.to.x-e.from.x),a=Math.atan2(e.from.y-e.to.y,e.from.x-e.to.x),r=e.from.edges.length-1;r>=0;r--){var n=e.from.edges[r],o=n.getOtherNode(e.from),i=Math.atan2(o.y-e.from.y,o.x-e.from.x),s=t-i;if(Math.abs(s)<m)throw console.log(e),new Error("Tried to add edge ".concat(e.idString()," parallel to existing incident edge."));if(s>0)break;e.from.edges[r+1]=n}for(e.from.edges[r+1]=e,r=e.to.edges.length-1;r>=0;r--){var c=e.to.edges[r],d=c.getOtherNode(e.to),l=Math.atan2(d.y-e.to.y,d.x-e.to.x),f=a-l;if(Math.abs(f)<m)throw console.log(e),new Error("Tried to add edge parallel to existing incident edge.");if(f>0)break;e.to.edges[r+1]=c}e.to.edges[r+1]=e,this.edges.set(e.idString(),e)}},{key:"getEdge",value:function(e,t){var a=S(e.id,t.id);return this.edges.get(a)}},{key:"removeEdge",value:function(e){var t=e.from.edges.indexOf(e),a=e.to.edges.indexOf(e);if(-1==t||-1==a||!this.edges.delete(e.idString()))throw new Error("Edge ".concat(e.from.id," -> ").concat(e.to.id," not in graph or not in node edge list."));e.from.edges.splice(t,1),e.to.edges.splice(a,1)}},{key:"removeEdgeFromVertices",value:function(e,t){var a=this.getEdge(e,t);if(!a)throw new Error("Edge (".concat(e.id,", ").concat(t.id,") not in graph."));this.removeEdge(a)}}]),e}(),$=function(e){Object(c["a"])(a,e);var t=Object(d["a"])(a);function a(){return Object(s["a"])(this,a),t.apply(this,arguments)}return Object(v["a"])(a,[{key:"getDistances",value:function(){var e,t=new Map,a=Object(y["a"])(this.nodes.keys());try{for(a.s();!(e=a.n()).done;){var r=e.value,n=this.nodes.get(r);if(1==n.edges.length){var o=new Map;this.getDistancesRecursive(o,0,[],n,n.edges[0]),t.set(r,o)}}}catch(i){a.e(i)}finally{a.f()}return t}},{key:"getDistancesRecursive",value:function(e,t,a,r,n){t+=n.length;var o=n.getOtherNode(r);if(a.push([o.id,t]),1==o.edges.length)e.set(o.id,a);else{var i,s=Object(y["a"])(o.edges);try{for(s.s();!(i=s.n()).done;){var c=i.value;c.getOtherNode(o)!=r&&this.getDistancesRecursive(e,t,Array.from(a),o,c)}}catch(d){s.e(d)}finally{s.f()}}}},{key:"dangle",value:function(e){var t=null;if(void 0!=this.debugOverrideRootId)t=this.nodes.get(this.debugOverrideRootId);else if("unset"==e){var a,r=Object(y["a"])(this.nodes.values());try{for(r.s();!(a=r.n()).done;){var n=a.value;n.edges.length>=2&&(null==t||t.y<n.y)&&(t=n)}}catch(i){r.e(i)}finally{r.f()}}else t=this.nodes.get(e);if(null==t)throw new Error("Tree has no non-leaf nodes.");var o=new Map;return o.set("unset",1e3),this.dangleRecursive(o,t,0),o}},{key:"dangleRecursive",value:function(e,t,a){if(!e.has(t.id)){e.set(t.id,a);var r,n=Object(y["a"])(t.edges);try{for(n.s();!(r=n.n()).done;){var o=r.value,i=o.getOtherNode(t);this.dangleRecursive(e,i,a+1)}}catch(s){n.e(s)}finally{n.f()}}}}]),a}(D);(function(e){e[e["NewlyCreated"]=0]="NewlyCreated",e[e["Clean"]=1]="Clean",e[e["PreUMA"]=2]="PreUMA",e[e["PostUMA"]=3]="PostUMA",e[e["PreFacetOrdering"]=4]="PreFacetOrdering",e[e["FullyAssigned"]=5]="FullyAssigned"})(B||(B={}));var z=function(e){Object(c["a"])(a,e);var t=Object(d["a"])(a);function a(e){var r;Object(s["a"])(this,a),r=t.call(this),r.state=B.NewlyCreated,r.leafExtensions=new Map,r.faces=new Set,r.nextInternalNodeIndex=1;var n,o=Object(y["a"])(e.nodes.keys());try{for(o.s();!(n=o.n()).done;){var i=n.value,c=e.nodes.get(i),d=new G(i,i,c.x,c.y,0);r.addNode(d),r.leafExtensions.set(d,0)}}catch(l){o.e(l)}finally{o.f()}return r}return Object(v["a"])(a,[{key:"nextInternalId",value:function(){return"i"+(this.nextInternalNodeIndex++).toString()}},{key:"subdivideCrease",value:function(e,t,a,r,n){if(this.state!=B.PreUMA)throw new Error("Do not call subdivideCrease from state ".concat(this.state,"."));var o=e.from,i=e.to,s=e.leftFace,c=e.rightFace,d=s.nodes.indexOf(i),l=c.nodes.indexOf(o),f=e.creaseType,u=e.baseFace;this.removeEdge(e);var h=new G(this.nextInternalId(),r,t,a,n);this.addNode(h);var g=new H(h,o,f,u);this.addEdge(g),g.leftFace=s,g.rightFace=c;var v=new H(i,h,f,u);if(this.addEdge(v),v.leftFace=s,v.rightFace=c,s!=c&&(s.nodes.splice(d,0,h),c.nodes.splice(l,0,h)),void 0==this.getEdge(h,o))throw console.log(this.edges),new Error("Problem subdividing crease - cannot find one of the new edges.");return h}},{key:"suppressNodeIfRedundant",value:function(e,t){if(this.state!=B.PreUMA)throw new Error("Do not call suppressRidgeNodeIfRedundant from state ".concat(B[this.state],"."));if(2==e.edges.length){var a=e.edges[0],r=e.edges[1],n=a.getOtherNode(e),o=r.getOtherNode(e),i=Math.atan2(e.y-n.y,e.x-n.x),s=Math.atan2(o.y-n.y,o.x-n.x),c=a.creaseType,d=a.baseFace;if(Math.abs(i-s)<m){if(c!=r.creaseType||c!=C.Ridge&&c!=C.Hinge)throw new Error("Invalid crease types: edge ".concat(a.idString()," is of type ").concat(a.creaseType," and edge ").concat(r.idString()," is of type ").concat(r.creaseType,"."));t.delete(a),t.delete(r),this.removeEdge(a),this.removeEdge(r),this.nodes.delete(e.id);var l=n.elevation<o.elevation?new H(o,n,c,d):new H(n,o,c,d);return t.add(l),this.addEdge(l),!0}}return!1}},{key:"fillInFaceToTheLeft",value:function(e,t){if(this.state!=B.PostUMA)throw new Error("Do not call fillInFaceToTheLeft from state ".concat(B[this.state],"."));var a=new L;this.faces.add(a),a.baseFaceLocalRoot=t.baseFace;for(var r=e,n=t,o=0;o<100;o++){a.nodes.push(r),r==n.from?n.leftFace=a:n.rightFace=a;var i=n.creaseType==C.Axial||n.creaseType==C.ActiveHull||n.creaseType==C.InactiveHull;if(n.creaseType==C.Pseudohinge)a.hasPseudohinge=!0;else if(n.creaseType==C.InactiveHull&&!a.isOuterFace){if(null!=a.inactiveHullEdge)throw new Error("Face ".concat(a.nodes.map((function(e){return e.id}))," has at least two inactive hull edges: ").concat(a.inactiveHullEdge.idString()," and ").concat(n.idString(),"."));a.inactiveHullEdge=n}if(r=n.getOtherNode(r),n=r.clockwise(n),i&&(a.creaseToNextAxialFacet=n),r==e&&n==t)return a}throw new Error("Caught in infinite loop while filling in new face in UMA.")}},{key:"annotateFaceData",value:function(e){if(this.state!=B.PostUMA)throw new Error("Do not call annotateFaceData from state ".concat(B[this.state],"."));var t,a=0,r=e.nodes[e.nodes.length-1],n=Object(y["a"])(e.nodes);try{for(n.s();!(t=n.n()).done;){var o=t.value;""!=o.displayId&&e.flap.add(o.displayId);var i=this.getEdge(r,o);if(i.creaseType==C.Ridge){var s=i.sumElevations(),c=i.getOtherFace(e);c.hasPseudohinge&&(r.hasPseudohinge||o.hasPseudohinge)?(a=2,e.crossRidge=c):s>a&&(a=s,e.crossRidge=c)}else if(i.creaseType==C.Gusset||i.creaseType==C.Pseudohinge){if(null!=e.crossGussetOrPseudohinge)throw console.log(i),new Error("Found two gusset/pseudohinge creases on one face, second is ".concat(i.idString(),", which has type ").concat(C[i.creaseType],"."));e.crossGussetOrPseudohinge=i.getOtherFace(e)}else if(i.creaseType==C.Hinge);else{if(null!=e.crossAxialOrHull)throw console.log(i),new Error("Found two axial/hull creases on one face, second is ".concat(i.idString(),", which has type ").concat(C[i.creaseType],"."));e.crossAxialOrHull=i.getOtherFace(e),e.corridor=[e]}r=o}}catch(d){n.e(d)}finally{n.f()}return null!=e.crossAxialOrHull}},{key:"rebuildFaces",value:function(e,t){if(this.state!=B.PostUMA)throw new Error("Do not call rebuildFaces from state ".concat(B[this.state],"."));var a=this.faces;a.delete(e),this.faces=new Set([e]);var r,n=Object(y["a"])(t);try{for(n.s();!(r=n.n()).done;){var o=r.value;(null==o.leftFace||a.has(o.leftFace))&&this.fillInFaceToTheLeft(o.from,o),(null==o.rightFace||a.has(o.rightFace))&&this.fillInFaceToTheLeft(o.to,o)}}catch(P){n.e(P)}finally{n.f()}var i=this.nodes.size-this.edges.size+this.faces.size;if(2!=i)throw new Error("Euler characteristic check failed after building faces: v=".concat(this.nodes.size,", e=").concat(this.edges.size,", f=").concat(this.faces.size));var s,c=new Set,d=Object(y["a"])(this.faces);try{for(d.s();!(s=d.n()).done;){var l=s.value;l!=e&&this.annotateFaceData(l)&&!l.hasPseudohinge&&c.add(l)}}catch(P){d.e(P)}finally{d.f()}for(var f=0;f<500;f++){if(0==c.size)return;var u=M(c);c.delete(u);for(var h=!0,g=u.corridor,v=new Set(u.flap),p=0;p<100;p++){var b=p%2==0?u.crossRidge:u.crossGussetOrPseudohinge;if(null==b){var w=c.delete(u);if(!w)throw console.log(g),new Error("Corridor ".concat(g.map((function(e){return"["+e.nodes.map((function(e){return e.id}))+"]"}))," ended somewhere that wasn't in list of axial facets."));if(u.corridor=Array.from(g).reverse(),2!=v.size)throw console.log(u),new Error("Could not determine flap: ".concat(Array.from(v),"."));var O,m=Object(y["a"])(g);try{for(m.s();!(O=m.n()).done;){var j=O.value;j.flap=v}}catch(P){m.e(P)}finally{m.f()}h=!1;break}g.push(b);var x,k=Object(y["a"])(b.flap);try{for(k.s();!(x=k.n()).done;){var E=x.value;v.add(E)}}catch(P){k.e(P)}finally{k.f()}u=b}if(h)throw new Error("Caught in infinite loop while building corridors (2).")}throw new Error("Caught in infinite loop while building corridors (1).")}},{key:"findAGoodRoot",value:function(e){var t,a=new Map,r=Object(y["a"])(this.edges.values());try{for(r.s();!(t=r.n()).done;){var n=t.value;if(n.creaseType==C.Axial){var o=Array.from(e.get(n.from.id).get(n.to.id));o.pop();for(var i=0,s=o;i<s.length;i++){var c=Object(w["a"])(s[i],2),d=c[0];c[1];a.has(d)?a.set(d,a.get(d)+1):a.set(d,1)}}}}catch(b){r.e(b)}finally{r.f()}var l,f="unset",u=0,h=Object(y["a"])(a);try{for(h.s();!(l=h.n()).done;){var g=Object(w["a"])(l.value,2),v=g[0],p=g[1];p>u&&(u=p,f=v)}}catch(b){h.e(b)}finally{h.f()}return f}}]),a}(D),V=function(e){Object(c["a"])(a,e);var t=Object(d["a"])(a);function a(){var e;return Object(s["a"])(this,a),e=t.call(this),e.readyToCreateNewPoint=!0,e.pointIdsInUse=new Set,e.nextPointId=1,e.edgeLengthLabelOf=new Map,e.treePoints=new Map,e.edgeLengthLabelOf=new Map,e.adjustVerts=void 0,e.adjustPt=void 0,e.adjustAngle=void 0,e.treeBoard=null,e.undoPoints=[],e.currentUndoPoint=0,e}return Object(v["a"])(a,[{key:"resetState",value:function(){this.readyToCreateNewPoint=!0,this.pointIdsInUse=new Set,this.nextPointId=1,this.edgeLengthLabelOf=new Map,this.treePoints=new Map,this.edgeLengthLabelOf=new Map,this.adjustVerts=void 0,this.adjustPt=void 0,this.adjustAngle=void 0}},{key:"mounted",value:function(){var e=this;this.treeBoard=O["JSXGraph"].initBoard("treeViewBox",{boundingbox:[0,10,10,0],showCopyright:!1});var t=this.createPoint(5,4),a=this.createPoint(5,6);this.treePoints.set(t,new Set),this.treePoints.set(a,new Set),this.createLine(t,a),this.setUndoPoint(!0),window.addEventListener("keydown",(function(t){t.ctrlKey&&"y"===t.key&&e.currentUndoPoint<e.undoPoints.length-1?e.deserialize(e.undoPoints[++e.currentUndoPoint]):t.ctrlKey&&"z"===t.key&&e.currentUndoPoint>0&&e.deserialize(e.undoPoints[--e.currentUndoPoint])})),this.treeBoard.on("move",(function(t){if(e.adjustVerts){var a,r=e.toCoords(t),n=Object(w["a"])(r,2),o=n[0],i=n[1],s=Math.atan2(i-e.adjustPt[1],o-e.adjustPt[0]),c=Math.sin(s-e.adjustAngle),d=Math.cos(s-e.adjustAngle),l=Object(y["a"])(e.adjustVerts);try{for(l.s();!(a=l.n()).done;){var f=a.value;f.v.moveTo([d*(f.orig[0]-e.adjustPt[0])-c*(f.orig[1]-e.adjustPt[1])+e.adjustPt[0]+f.offset[0],c*(f.orig[0]-e.adjustPt[0])+d*(f.orig[1]-e.adjustPt[1])+e.adjustPt[1]+f.offset[1]])}}catch(u){l.e(u)}finally{l.f()}}}))}},{key:"serialize",value:function(){var e=new $,t=new Map;this.treePoints.forEach((function(a,r){var n=r.X(),o=r.Y(),i=new _(r.name.toString(),n,o);e.addNode(i),t.set([n,o].toString(),i)}));var a=new Set;return this.treePoints.forEach((function(r){var n,o=Object(y["a"])(r);try{for(o.s();!(n=o.n()).done;){var i=n.value,s=i.point1,c=i.point2,d=s.X(),l=s.Y(),f=c.X(),u=c.Y();if(!a.has([d,l,f,u].toString())&&!a.has([f,u,d,l].toString())){var h=t.get([d,l].toString()),g=t.get([f,u].toString()),v=Math.sqrt(Math.pow(d-f,2)+Math.pow(l-u,2)),p=new N(h,g,v);e.addEdge(p),a.add([d,l,f,u].toString()),a.add([f,u,d,l].toString())}}}catch(b){o.e(b)}finally{o.f()}})),e}},{key:"deserialize",value:function(e){var t=this;this.treeBoard.suspendUpdate(),this.treeBoard.removeObject(Array.from(this.treeBoard.objectsList)),this.resetState();var a=new Map;e.nodes.forEach((function(e){var r=t.createPoint(e.x,e.y,parseInt(e.id));t.treePoints.set(r,new Set),a.set(e.id,r)})),this.resetNextPointId(),e.edges.forEach((function(e){t.createLine(a.get(e.to.id),a.get(e.from.id))})),this.treeBoard.unsuspendUpdate()}},{key:"setUndoPoint",value:function(e){var t=this.serialize();e?this.undoPoints=[t]:(this.currentUndoPoint!=this.undoPoints.length-1&&(this.undoPoints=this.undoPoints.slice(0,this.currentUndoPoint+1)),this.undoPoints.push(t),++this.currentUndoPoint)}},{key:"propagate",value:function(){this.$store.commit("updateTreeGraph",this.undoPoints[this.currentUndoPoint])}},{key:"findSubtree",value:function(e,t,a,r){e.push(r);var n,o=Object(y["a"])(this.treePoints.get(r));try{for(o.s();!(n=o.n()).done;){var i=n.value;t.add(i);for(var s=0,c=[i.point1,i.point2];s<c.length;s++){var d=c[s];d!=a&&d!=r&&this.findSubtree(e,t,r,d)}}}catch(l){o.e(l)}finally{o.f()}return[e,t]}},{key:"changeEdgeLength",value:function(e,t){var a=Number(prompt("Distance between point "+e.name+" and point "+t.name+":",""));if(a>0){var r,n=e.Dist(t),o=t.X()-e.X(),i=t.Y()-e.Y(),s=o*a/n-o,c=i*a/n-i,d=this.findSubtree([],new Set,t,e)[0],l=this.findSubtree([],new Set,e,t)[0];d.length<l.length?(r=d,s=-s,c=-c):r=l;var f,u=Object(y["a"])(r);try{for(u.s();!(f=u.n()).done;){var h=f.value;h.setPosition(O["COORDS_BY_USER"],[h.X()+s,h.Y()+c])}}catch(g){u.e(g)}finally{u.f()}this.setUndoPoint()}}},{key:"deleteLine",value:function(e){for(var t=0,a=[e.point1,e.point2];t<a.length;t++){var r=a[t],n=this.treePoints.get(r);n.delete(e)}this.treeBoard.removeObject(e);var o=this.edgeLengthLabelOf.get(e);this.treeBoard.removeObject(o),this.edgeLengthLabelOf.delete(e)}},{key:"deleteSubtree",value:function(e,t){var a,r,n=this.findSubtree([],new Set,t,e),o=Object(w["a"])(n,2),i=o[0],s=o[1],c=this.findSubtree([],new Set,e,t),d=Object(w["a"])(c,2),l=d[0],f=d[1];i.length<l.length?(a=i,r=s):(a=l,r=f);var u,h=Object(y["a"])(r);try{for(h.s();!(u=h.n()).done;){var g=u.value;this.deleteLine(g)}}catch(O){h.e(O)}finally{h.f()}var v,p=Object(y["a"])(a);try{for(p.s();!(v=p.n()).done;){var b=v.value;this.pointIdsInUse.delete(b.name),this.treeBoard.removeObject(b),this.treePoints.delete(b)}}catch(O){p.e(O)}finally{p.f()}this.resetNextPointId(),this.setUndoPoint()}},{key:"createLine",value:function(e,t){var a=this.treeBoard.create("segment",[e,t],{fixed:!0}),r=this.treeBoard.create("text",[function(a){return(e.X()+t.X())/2},function(a){return(e.Y()+t.Y())/2},function(){return e.Dist(t).toFixed(2)}],{highlight:!1});return this.treePoints.get(e).add(a),this.treePoints.get(t).add(a),this.edgeLengthLabelOf.set(a,r),a.on("up",function(a){this.adjustVerts?(this.adjustVerts=void 0,this.adjustPt=void 0,this.adjustAngle=void 0,this.setUndoPoint()):a.shiftKey&&this.deleteSubtree(e,t)}.bind(this)),a.on("down",function(a){if(3===a.which&&this.changeEdgeLength(e,t),a.altKey){var r=this.toCoords(a),n=Object(w["a"])(r,2),o=n[0],i=n[1],s=Math.pow(e.X()-o,2)+Math.pow(e.Y()-i,2),c=Math.pow(t.X()-o,2)+Math.pow(t.Y()-i,2),d=s<c?t:e,l=s<c?e:t,f=this.findSubtree([],new Set,d,l),u=Object(w["a"])(f,2),h=u[0];u[1];this.adjustVerts=h.map((function(e){return{orig:a.ctrlKey?[l.X(),l.Y()]:[e.X(),e.Y()],offset:a.ctrlKey?[e.X()-l.X(),e.Y()-l.Y()]:[0,0],v:e}})),this.adjustPt=[d.X(),d.Y()],this.adjustAngle=Math.atan2(i-d.Y(),o-d.X())}}.bind(this)),a}},{key:"createPoint",value:function(e,t,a){var r=a||this.nextPointId,n=this.treeBoard.create("point",[e,t],{name:r,label:{offset:[6,6],highlight:!1}});if(n.on("up",function(e){this.readyToCreateNewPoint&&this.setUndoPoint(),this.readyToCreateNewPoint=!0}.bind(this)),n.on("down",function(e){if(e.ctrlKey&&this.readyToCreateNewPoint){this.readyToCreateNewPoint=!1;var t=this.createPoint(n.X(),n.Y());this.treePoints.set(t,new Set);var a,r=new Set(this.treePoints.get(n)),o=Object(y["a"])(r);try{for(o.s();!(a=o.n()).done;){var i=a.value,s=null;i.point1===n?s=i.point2:i.point2===n?s=i.point1:(console.log("Error: Line in treePoints not incident."),console.log(n.name),console.log(i.point1.name),console.log(i.point2.name)),this.deleteLine(i),this.createLine(s,n);break}}catch(c){o.e(c)}finally{o.f()}this.createLine(n,t)}}.bind(this)),this.pointIdsInUse.add(r),!a)while(this.pointIdsInUse.has(this.nextPointId))this.nextPointId++;return n}},{key:"resetNextPointId",value:function(){this.nextPointId=1;while(this.pointIdsInUse.has(this.nextPointId))this.nextPointId++}},{key:"toCoords",value:function(e){var t=this.treeBoard.getCoordsTopLeftCorner(e,0),a=Object(O["getPosition"])(e),r=new O["Coords"](O["COORDS_BY_SCREEN"],[a[0]-t[0],a[1]-t[1]],this.treeBoard);return[r.usrCoords[1],r.usrCoords[2]]}}]),a}(f["b"]);V=Object(l["a"])([f["a"]],V);var q=V,Y=q,J=a("2877"),K=Object(J["a"])(Y,p,b,!1,null,null,null),W=K.exports,Z=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"viewBox",attrs:{id:"creasesViewBox"}})},Q=[],ee=a("21a6");function te(e,t){if(t&&e.creaseType==C.Hinge)return"B";switch(e.assignment){case I.Mountain:return"M";case I.Valley:return"V";case I.Unfolded:return"F"}return"B"}function ae(e){var t,a=[],r=[],n=[],o=[],i=[],s=Array.from(e.nodes.keys()).sort(),c=Array.from(e.edges.keys()).sort(),d=s.map((function(e){return[]})),l=Object(y["a"])(s);try{for(l.s();!(t=l.n()).done;){var f=t.value,u=e.nodes.get(f);a.push([u.x,u.y])}}catch(A){l.e(A)}finally{l.f()}var h,g=Object(y["a"])(c.entries());try{for(g.s();!(h=g.n()).done;){var v=Object(w["a"])(h.value,2),p=v[0],b=v[1],O=e.edges.get(b),m=s.indexOf(O.to.id),j=s.indexOf(O.from.id);d[m].push(p),d[j].push(p),r.push([m,j]);var x=te(O,!0);n.push(x),"M"===x?o.push(-180):"V"===x?o.push(180):"F"===x?o.push(0):o.push(null)}}catch(A){g.e(A)}finally{g.f()}var k,E=Object(y["a"])(e.faces);try{for(E.s();!(k=E.n()).done;){var P=k.value;if(!P.isOuterFace){var F,M=[],S=Object.assign([],P.nodes).reverse(),C=Object(y["a"])(S);try{for(C.s();!(F=C.n()).done;){var I=F.value,T=s.indexOf(I.id);M.push(T)}}catch(A){C.e(A)}finally{C.f()}i.push(M)}}}catch(A){E.e(A)}finally{E.f()}return{file_spec:"1.1",file_creator:"TreeFaker",file_classes:["creasePattern"],vertices_coords:a,edges_vertices:r,edges_assignment:n,edges_foldAngle:o,vertices_edges:d,faces_vertices:i}}var re=a("2909");function ne(e,t,a,r,n){var o=r.get(e.id).get(t.id),i=o[o.length-1][1];return a*(i+n.get(e)+n.get(t))}function oe(e,t,a,r,n,o){var i=t.x-e.x,s=t.y-e.y,c=Math.sqrt(i*i+s*s),d=c-ne(e,t,a,r,n);if(d<-o)throw console.log("distanceOnPlane: ".concat(c,"    activeDIstance: ").concat(ne(e,t,a,r,n))),new Error("Insufficient slack of ".concat(d," between nodes '").concat(e.id,"' and '").concat(t.id,"'."));return d<o}function ie(e,t,a,r,n,o,i){var s=a*a,c=o*o,d=r-e,l=n-t,f=i?-l:l,u=i?d:-d,h=d*d+l*l,g=2*h,v=h-c+s,p=v/g,b=Math.sqrt(4*h*s-v*v)/g,y=e+d*p+f*b,w=t+l*p+u*b;return[y,w]}function se(e){var t=e.edges.length;if(t<2)throw new Error("There are ".concat(t," edges incident to Node ").concat(e.id,"."));for(var a=0;a<t;a++){var r=e.edges[a],n=e.edges[(a+1)%t],o=r.getOtherNode(e),i=n.getOtherNode(e),s=Math.atan2(o.y-e.y,o.x-e.x),c=Math.atan2(i.y-e.y,i.x-e.x);c<s&&(c+=2*Math.PI);var d=c-s;if(d>Math.PI+m)return[a,o,i]}return[null,null,null]}function ce(e,t){if(e.nodes.size<2)throw new Error("Must have at least two nodes in packing.");var a,r=new z(e),n=Object(y["a"])(r.nodes.values());try{for(n.s();!(a=n.n()).done;){var o,i=a.value,s=Object(y["a"])(r.nodes.values());try{for(s.s();!(o=s.n()).done;){var c=o.value;if(i.id<c.id&&oe(i,c,e.scaleFactor,t,r.leafExtensions,m)){var d=new H(c,i,C.Axial,null);r.addEdge(d)}}}catch(Je){s.e(Je)}finally{s.f()}}}catch(Je){n.e(Je)}finally{n.f()}var l=new Set(r.nodes.values());function f(a,n,o,i){var s=r.leafExtensions.get(a);r.leafExtensions.set(a,s+n/e.scaleFactor),e.nodes.get(a.id).x=o,e.nodes.get(a.id).y=i,a.x=o,a.y=i,a.onBoundaryOfSquare=a.x<m||a.y<m||a.x>1-m||a.y>1-m;for(var c=0,d=Object(re["a"])(a.edges);c<d.length;c++){var f=d[c];l.add(f.getOtherNode(a)),r.removeEdge(f)}var u,h=Object(y["a"])(r.nodes.values());try{for(h.s();!(u=h.n()).done;){var g=u.value;if(g!=a&&oe(a,g,e.scaleFactor,t,r.leafExtensions,j)){var v=new H(a,g,C.Axial,null);r.addEdge(v)}}}catch(Je){h.e(Je)}finally{h.f()}}for(var u=0;u<500;u++){if(0==l.size)return r.state=B.Clean,r;var h=M(l);l.delete(h);var g=h.edges.length;if(0==g){var v,p=2,b=Object(y["a"])(r.nodes.values());try{for(b.s();!(v=b.n()).done;){var O=v.value;if(O!=h){var k=O.x-h.x,E=O.y-h.y,P=Math.sqrt(k*k+E*E),F=P-ne(h,O,e.scaleFactor,t,r.leafExtensions);F<p&&(p=F)}}}catch(Je){b.e(Je)}finally{b.f()}if(2==p)throw new Error("Did not find a new binding constraint.");if(p<=0)throw new Error("Should have detected active path earlier.");f(h,p,h.x,h.y),l.add(h)}else if(!h.onBoundaryOfSquare)if(1==g){var S,I=h.x,T=h.y,A=h.edges[0].getOtherNode(h),_=I-A.x,N=T-A.y,U=Math.sqrt(_*_+N*N),R=_/U,G=N/U,L=2,X=-1,D=-1,$=Object(y["a"])(r.nodes.values());try{for($.s();!(S=$.n()).done;){var V=S.value;if(V!=h&&V!=A){var q=V.x,Y=V.y,J=I-q,K=T-Y,W=ne(h,V,e.scaleFactor,t,r.leafExtensions),Z=(W*W-J*J-K*K)/(2*(R*J+G*K-W));0<Z&&Z<L&&(L=Z,X=I+Z*R,D=T+Z*G)}}}catch(Je){$.e(Je)}finally{$.f()}if(Math.abs(R)>m)for(var Q=0,ee=[-I/R,(1-I)/R];Q<ee.length;Q++){var te=ee[Q];0<te&&te<L&&(L=te,X=I+te*R,D=T+te*G)}if(Math.abs(G)>m)for(var ae=0,ce=[-T/G,(1-T)/G];ae<ce.length;ae++){var de=ce[ae];0<de&&de<L&&(L=de,X=I+de*R,D=T+de*G)}if(2==L)throw new Error("Did not find a new binding constraint.");f(h,L,X,D),l.add(h)}else{var le=se(h),fe=Object(w["a"])(le,3),ue=fe[0],he=fe[1],ge=fe[2];if(null!=ue){var ve=he,pe=ge,be=ve.x,ye=ve.y,we=pe.x,Oe=pe.y,me=ne(h,ve,e.scaleFactor,t,r.leafExtensions),je=ne(h,pe,e.scaleFactor,t,r.leafExtensions),xe=we-be,ke=Oe-ye,Ee=-ke,Pe=xe,Fe=(h.x-ve.x)*Ee+(h.y-ve.y)*Pe>0,Me=new Set(Array.from(r.nodes.values()));Me.delete(h);var Se,Ce=Object(y["a"])(h.edges);try{for(Ce.s();!(Se=Ce.n()).done;){var Ie=Se.value;Me.delete(Ie.getOtherNode(h))}}catch(Je){Ce.e(Je)}finally{Ce.f()}for(var Te=1,Ae=.5;Ae>x;Ae/=2){var _e=ie(be,ye,me+Te,we,Oe,je+Te,Fe),Ne=Object(w["a"])(_e,2),Ue=Ne[0],Re=Ne[1],Ge=Ue<0||Re<0||Ue>1||Re>1;if(!Ge){var Be,He=Object(y["a"])(Me);try{for(He.s();!(Be=He.n()).done;){var Le=Be.value,Xe=Le.x-Ue,De=Le.y-Re,$e=Math.sqrt(Xe*Xe+De*De);if($e<ne(h,Le,e.scaleFactor,t,r.leafExtensions)+Te){Ge=!0;break}}}catch(Je){He.e(Je)}finally{He.f()}}Ge?Te-=Ae:Te+=Ae}var ze=ie(be,ye,me+Te,we,Oe,je+Te,Fe),Ve=Object(w["a"])(ze,2),qe=Ve[0],Ye=Ve[1];f(h,Te,qe,Ye),l.add(h)}}}throw new Error("Caught in infinite loop while cleaning packing.")}function de(e,t,a){var r=Math.atan2(e.y-t.y,e.x-t.x),n=Math.atan2(a.y-t.y,a.x-t.x),o=n-r;return o<0?[o<k,o>-m||o<P]:[o<E,o<m||o>F]}function le(e){if(e.state!=B.Clean)throw new Error("Should not be calling buildFaces from state ".concat(B[e.state],"."));var t,a=2,r=null,n=[],o=Object(y["a"])(e.nodes.values());try{for(o.s();!(t=o.n()).done;){var i=t.value;i.x<a?(null!=r&&n.push(r),a=i.x,r=i):n.push(i)}}catch(N){o.e(N)}finally{o.f()}if(null==r)throw new Error("Bad node x values.");var s=r;n.sort((function(e,t){var a=Math.atan2(e.y-s.y,e.x-s.x),r=Math.atan2(t.y-s.y,t.x-s.x);return r-a}));for(var c=[s],d=!0,l=0;l<200;l++){if(0==n.length){d=!1;break}var f=n.pop();while(c.length>1){var u=de(c[c.length-2],c[c.length-1],f),h=Object(w["a"])(u,2),g=h[0],v=h[1];if(!g)break;var p=c.pop();v&&n.push(p)}c.push(f)}if(d)throw new Error("Caught in infinite loop while computing convex hull.");for(var b=0;b<c.length;b++){var O=c[b],m=c[(b+1)%c.length],j=e.getEdge(O,m);void 0==j?e.addEdge(new H(m,O,C.InactiveHull,null)):j.updateCreaseType(C.ActiveHull)}var x=!1,k=new Set(e.edges.values()),E=new Set,P=c[0],F=c[1],S=e.getEdge(P,F);function I(t,a){var r=new L;if(e.faces.add(r),a==S&&a.getOtherNode(t)==P){if(x)throw new Error("Already found outer face.");r.isOuterFace=!0,x=!0}for(var n=t,o=a,i=0;i<100;i++){if(r.nodes.push(n),n==o.from){if(null!=o.leftFace)throw new Error("Left face has already been set for edge ".concat(o.idString(),"."));o.leftFace=r}else{if(null!=o.right)throw new Error("Right face has already been set for edge ".concat(o.idString(),"."));o.rightFace=r}if(o.creaseType==C.InactiveHull&&!r.isOuterFace){if(null!=r.inactiveHullEdge)return"Face ".concat(r.nodes.map((function(e){return e.id}))," has at least two inactive hull edges: ").concat(r.inactiveHullEdge.idString()," and ").concat(o.idString(),".");r.inactiveHullEdge=o}if(n=o.getOtherNode(n),o=n.clockwise(o),n==t&&o==a)return null;k.delete(o)&&E.add(o)}throw new Error("Caught in infinite loop while building faces.")}E.add(S),k.delete(S);while(E.size>0){var T=M(E);if(E.delete(T),null==T.leftFace){var A=I(T.from,T);if(null!=A)return A}if(null==T.rightFace){var _=I(T.to,T);if(null!=_)return _}}if(!x)throw new Error("Could not find outer face.");if(k.size>0)throw new Error("Edges ".concat(Array.from(k).map((function(e){return e.idString()}))," lie in different component than first hull edge."));return e.state=B.PreUMA,null}function fe(e,t){if(t.state!=B.PreUMA)throw new Error("Should not be calling isTwisted from state ".concat(B[t.state],"."));var a,r=Object(y["a"])(t.faces);try{for(r.s();!(a=r.n()).done;)for(var n=a.value,o=new Set,i=0;i<n.nodes.length;i++)for(var s,c=n.nodes[i],d=n.nodes[(i+1)%n.nodes.length],l=null===(s=e.get(c.id))||void 0===s?void 0:s.get(d.id),f=l.length-2,u=0;u<f;u++){var h=l[u][0],g=l[u+1][0],v=h+"-"+g;if(o.has(v))return!0;o.add(v)}}catch(p){r.e(p)}finally{r.f()}return!1}function ue(e,t,a,r,n,o){for(var i=a.length,s=[],c=[],d=[],l=[],f=0;f<i;f++){var u=(f+i-1)%i,h=(f+1)%i,g=a[u],v=a[f],p=a[h],b=g.x-v.x,O=g.y-v.y,j=Math.sqrt(b*b+O*O),x=b/j,k=O/j;c.push([x,k]);var E=p.x-v.x,P=p.y-v.y,M=Math.sqrt(E*E+P*P),S=E/M,I=P/M;d.push([S,I]);var T=k-I,A=S-x,_=Math.sqrt(T*T+A*A),N=T/_,U=A/_,R=U*S-N*I,B=N/R,L=U/R;s.push([B,L]),l.push(B*x+L*k)}for(var X=2,D=0;D<i;D++)for(var $=D+1;$<i;$++){var z=Object(w["a"])(s[D],2),V=z[0],q=z[1],Y=Object(w["a"])(s[$],2),J=Y[0],K=Y[1],W=Math.atan2(q,V),Z=Math.atan2(K,J),Q=Math.abs(Z-W);if(!(Q<m||Q>F)){var ee=a[D],te=a[$];if($==D+1||0==D&&$==i-1){var ae=ee.x-te.x,re=ee.y-te.y,ne=J-V,oe=K-q,ie=ne*ne+oe*oe;if(ie>0){var se=ae*ae+re*re,ce=Math.sqrt(se/ie);X>ce&&(X=ce)}}else{var de=0,le=r.get(ee);if(void 0==le){var fe=r.get(te).get(ee);de=fe[fe.length-1][1]}else{var he=le.get(te);void 0==he&&(he=r.get(te).get(ee)),de=he[he.length-1][1]}var ge=ee.x-te.x,ve=ee.y-te.y,pe=V-J,be=q-K,ye=l[D]+l[$],we=pe*pe+be*be-ye*ye,Oe=ge*pe+ve*be+de*ye,me=ge*ge+ve*ve-de*de,je=Oe*Oe-we*me;if(je<0)continue;var xe=(-Oe+Math.sqrt(je))/we,ke=de-xe*ye;ke>0&&xe>0&&X>xe&&(X=xe),xe=(-Oe-Math.sqrt(je))/we,ke=de-xe*(l[D]+l[$]),ke>0&&xe>0&&X>xe&&(X=xe)}}}var Ee=o+X,Pe=[],Fe=[],Me=new Map;function Se(t,a,r,n){var o,i=Object(y["a"])(r?Pe:Fe);try{for(i.s();!(o=i.n()).done;){var s=o.value;if(Math.abs(s.x-t)<m&&Math.abs(s.y-a)<m)return""!=n&&(s.displayId=n),[s,!1]}}catch(d){i.e(d)}finally{i.f()}var c=new G(e.nextInternalId(),n,t,a,Ee);return[c,!0]}for(var Ce=0;Ce<a.length;Ce++){var Ie=a[Ce],Te=Object(w["a"])(s[Ce],2),Ae=Te[0],_e=Te[1],Ne=Ie.x+X*Ae,Ue=Ie.y+X*_e,Re=Se(Ne,Ue,!0,""),Ge=Object(w["a"])(Re,2),Be=Ge[0],He=Ge[1];He&&(Pe.push(Be),e.addNode(Be)),Ie.goUpRidge=Be;var Le=new H(Be,Ie,C.Ridge,t);Me.set(Le,[]),n.add(Le),e.addEdge(Le)}var Xe=Pe.length,De=null,$e=null;2==Pe.length&&(De=Pe[0],$e=Pe[1]);for(var ze=0;ze<i;ze++)for(var Ve=ze+1;Ve<i;Ve++){var qe=X*l[Ve],Ye=X*l[ze],Je=a[Ve],Ke=a[ze];if(void 0==r.get(Je)||void 0==r.get(Je).get(Ke)){var We=Je;Je=Ke,Ke=We;var Ze=qe;qe=Ye,Ye=Ze}var Qe=Je.goUpRidge,et=Ke.goUpRidge,tt=Ve==ze+1||0==ze&&Ve==i-1;if(!tt){if(et==Qe)continue;var at=Pe.indexOf(Qe),rt=(at+1)%Xe,nt=(at+Xe-1)%Xe;if(Pe[nt]==et||Pe[rt]==et)continue}var ot=r.get(Je).get(Ke),it=ot[ot.length-1][1],st=it-qe,ct=st-Ye,dt=[];void 0==r.get(Qe)&&r.set(Qe,new Map),r.get(Qe).set(et,dt);for(var lt=ot.length-1,ft=Qe,ut=0;ut<lt;ut++){var ht=Object(w["a"])(ot[ut],3),gt=ht[0],vt=ht[1],pt=ht[2];if(tt&&null==pt)throw new Error("Null internal node between ".concat(Je.id," and ").concat(Ke.id," at distance ").concat(vt,"."));var bt=vt-qe;if(bt<-m){if(tt){var yt=vt/qe,wt=Se((1-yt)*Je.x+yt*Qe.x,(1-yt)*Je.y+yt*Qe.y,!1,gt),Ot=Object(w["a"])(wt,2),mt=Ot[0],jt=Ot[1];jt&&(e.addNode(mt),Fe.push(mt),Me.get(e.getEdge(Je,Qe)).push([vt,mt]));var xt=new H(mt,pt,C.Hinge,t);n.add(xt),e.addEdge(xt)}}else if(bt<m){if(tt){Qe.displayId=gt;var kt=new H(Qe,pt,C.Hinge,t);n.add(kt),e.addEdge(kt)}}else if(bt<ct-m)if(tt){var Et=bt/ct,Pt=Se((1-Et)*Qe.x+Et*et.x,(1-Et)*Qe.y+Et*et.y,!1,gt),Ft=Object(w["a"])(Pt,2),Mt=Ft[0],St=Ft[1];if(St&&(e.addNode(Mt),Fe.push(Mt),dt.push([Mt.displayId,bt,Mt]),2==Xe)){var Ct=new H(Mt,ft,C.Ridge,t);n.add(Ct),e.addEdge(Ct),ft=Mt,De=ft,$e=et}var It=new H(Mt,pt,C.Hinge,t);n.add(It),e.addEdge(It)}else dt.push([gt,bt,null]);else if(bt<ct+m){if(et.displayId=gt,tt){var Tt=new H(et,pt,C.Hinge,t);n.add(Tt),e.addEdge(Tt)}}else{if(!(bt<st-m))throw new Error("Distance from ".concat(Je.id," to ").concat(pt.id," along boundary path to ").concat(Ke.id," is ").concat(vt,", which is too large (should be less than ").concat(st,")."));if(tt){var At=st-bt,_t=At/Ye,Nt=Se((1-_t)*Ke.x+_t*et.x,(1-_t)*Ke.y+_t*et.y,!1,gt),Ut=Object(w["a"])(Nt,2),Rt=Ut[0],Gt=Ut[1];Gt&&(e.addNode(Rt),Fe.push(Rt),Me.get(e.getEdge(Ke,et)).push([At,Rt]));var Bt=new H(Rt,pt,C.Hinge,t);n.add(Bt),e.addEdge(Bt)}}}dt.push([et.displayId,ct,et])}if(null!=De){var Ht=new H($e,De,C.Ridge,t);n.add(Ht),e.addEdge(Ht)}var Lt,Xt=Object(y["a"])(Me.keys());try{for(Xt.s();!(Lt=Xt.n()).done;){var Dt=Lt.value,$t=Me.get(Dt);if($t.length>0){$t.sort((function(e,t){return e[0]-t[0]})),n.delete(Dt),e.removeEdge(Dt);var zt,Vt=Dt.from,qt=Object(y["a"])($t.map((function(e){return e[1]})).concat(Dt.to));try{for(qt.s();!(zt=qt.n()).done;){var Yt=zt.value,Jt=new H(Vt,Yt,C.Ridge,t);n.add(Jt),e.addEdge(Jt),Vt=Yt}}catch(ma){qt.e(ma)}finally{qt.f()}}}}catch(ma){Xt.e(ma)}finally{Xt.f()}if(Xe>2){for(var Kt=[Xe-1,0],Wt=0;Wt<100;Wt++){if(0==Kt.length)return n;var Zt=Kt.pop(),Qt=Kt.pop(),ea=[Pe[Zt]],ta=Zt;while(ta<Qt){for(var aa=ta==Zt?Qt-1:Qt;aa>ta+1;aa--){var ra=Pe[ta],na=Pe[aa];if(void 0==r.get(ra)||void 0==r.get(ra).get(na)){var oa=ra;ra=na,na=oa}var ia=r.get(ra).get(na),sa=ia[ia.length-1][1],ca=na.x-ra.x,da=na.y-ra.y,la=Math.sqrt(ca*ca+da*da)-sa;if(la<m){if(la<-m)throw console.log(ia),console.log(sa),console.log(Math.sqrt(ca*ca+da*da)),new Error("Looks like h = ".concat(X," was inset too much, violating distance constraint."));for(var fa=ia.length-1,ua=ra,ha=0;ha<fa;ha++){var ga=Object(w["a"])(ia[ha],3),va=ga[0],pa=ga[1],ba=(ga[2],pa/sa),ya=new G(e.nextInternalId(),va,(1-ba)*ra.x+ba*na.x,(1-ba)*ra.y+ba*na.y,Ee);e.addNode(ya),ia[ha][2]=ya;var wa=new H(ua,ya,C.Gusset,t);n.add(wa),e.addEdge(wa),ua=ya}var Oa=new H(na,ua,C.Gusset,t);n.add(Oa),e.addEdge(Oa),Kt.push(aa),Kt.push(ta);break}}ea.push(Pe[aa]),ta=aa}ue(e,t,ea,r,n,Ee)}throw new Error("Caught in infinite loop while recursively building molecules.")}}function he(e,t,a,r){for(var n=Array.from(e.nodes.values()),o=n.length,i=new Map,s=new Set,c=0;c<o;c++){var d=n[c],l=t.get(d.id),f=new Map;i.set(d,f);for(var u=c+1;u<o;u++){var h=n[u],g=e.getEdge(d,h),v=l.get(h.id),p=[];f.set(h,p);var b=v.length-1,y=v[b][1]+e.leafExtensions.get(d)+e.leafExtensions.get(h);if(void 0!=g&&g.creaseType==C.InactiveHull)s.add(g);else for(var O=0;O<b;O++){var m=Object(w["a"])(v[O],2),j=m[0],x=m[1],k=x+e.leafExtensions.get(d);if(void 0!=g){var E=r.get(j);if(void 0==E)throw console.log(r),new Error("Undefined (".concat(E,") new discrete depth for local root '").concat(j,"'."));for(var P=0,F=[g.leftFace,g.rightFace];P<F.length;P++){var M=F[P],S=r.get(M.baseFaceLocalRoot);if(void 0==S)throw console.log(r),new Error("Undefined prior discrete depth for local root '".concat(M.baseFaceLocalRoot,"'."));E<S&&(M.baseFaceLocalRoot=j)}var I=k/y,T=g.from,A=g.to,_=e.subdivideCrease(g,(1-I)*d.x+I*h.x,(1-I)*d.y+I*h.y,j,0);if(g=e.getEdge(_,h),void 0==g)throw new Error("Cannot find next crease after subdividing between ".concat(T.id," and ").concat(A.id," with new node corresponding to ").concat(j," at (").concat(_.x,", ").concat(_.y,")."));p.push([_.displayId,k*a,_])}else p.push([j,k*a,null])}p.push([h.id,y*a,h])}}return[i,s]}function ge(e,t,a,r){if(e.state!=B.PreUMA)throw new Error("Should not be calling generateMolecules from state ".concat(B[e.state],"."));for(var n=[],o=null,i=0,s=Array.from(e.faces);i<s.length;i++){var c=s[i];c.isOuterFace?o=c:n.push([c,Array.from(c.nodes)])}if(null==o)throw new Error("Could not find outer face.");for(var d=he(e,t,a,r),l=Object(w["a"])(d,2),f=l[0],u=l[1],h=new Set,g=0,v=n;g<v.length;g++){var p=Object(w["a"])(v[g],2),b=p[0],O=p[1];ue(e,b,O,f,h,0)}for(var m=0,j=Array.from(e.nodes.values());m<j.length;m++){var x=j[m];e.suppressNodeIfRedundant(x,h)}var k,E=Object(y["a"])(u);try{for(E.s();!(k=E.n()).done;){var P=k.value,F=P.rightFace.isOuterFace,M=F?P.from:P.to,S=F?P.to:P.from,I=P,T=S.x,A=S.y,_=M.x,N=M.y,U=_-T,R=N-A,G=Math.sqrt(U*U+R*R);U/=G,I=S.clockwise(I),S=I.getOtherNode(S);for(var L=[],X=0;X<200;X++){if(S==M)break;L.push(S),I=S.clockwise(I),S=I.getOtherNode(S)}if(S!=M)throw new Error("Caught in infinite loop while filling in inactive hull face.");var D=P,$=D.getOtherFace(o);R/=G;for(var z=0,V=L;z<V.length;z++){var q=V[z];if(q.edges.length%2==1){var Y,J=C.Pseudohinge,K=Object(y["a"])(q.edges);try{for(K.s();!(Y=K.n()).done;){var W=Y.value;if(W.creaseType==C.Hinge){J=C.Hinge;break}}}catch(re){K.e(re)}finally{K.f()}J==C.Pseudohinge&&(q.hasPseudohinge=!0);var Z=U*(q.x-T)+R*(q.y-A),Q=U*Z+T,ee=R*Z+A,te=e.subdivideCrease(D,Q,ee,q.displayId,0);D=e.getEdge(M,te);var ae=new H(q,te,J,$);e.addEdge(ae)}}}}catch(re){E.e(re)}finally{E.f()}return e.state=B.PostUMA,e.rebuildFaces(o,h),e.state=B.PreFacetOrdering,r}function ve(e,t,a){if(e.facetOrderIndex<t.facetOrderIndex)return a?I.Mountain:I.Valley;if(e.facetOrderIndex>t.facetOrderIndex)return a?I.Valley:I.Mountain;throw new Error("Two faces have the same facetOrderIndex: ".concat(e.facetOrderIndex,"."))}function pe(e,t,a){if(t.isColored){if(t.coloring!=a)throw new Error("Coloring inconsistency on face ".concat(t.nodes.map((function(e){return e.id})),"."))}else{t.isColored=!0,t.coloring=a;var r,n=t.nodes[t.nodes.length-1],o=Object(y["a"])(t.nodes);try{for(o.s();!(r=o.n()).done;){var i=r.value,s=e.getEdge(n,i),c=s.getOtherFace(t);if(!c.isOuterFace)if(s.assignment==I.Unfolded)pe(e,c,a);else{var d=ve(t,c,a);if(s.assignment==I.Unknown)s.assignment=d;else if(s.assignment!=d)throw new Error("Inconsistency between faces ".concat(t.nodes.map((function(e){return e.id}))," and ").concat(c.nodes.map((function(e){return e.id})),": crease ").concat(s.idString()," [from node ").concat(s.from.displayId," at (").concat(s.from.x,", ").concat(s.from.y,") to node ").concat(s.to.displayId," at (").concat(s.to.x,", ").concat(s.to.y,")] should be assigned ").concat(I[d]," but is actually assigned ").concat(I[s.assignment],"."));pe(e,c,!a)}n=i}}catch(l){o.e(l)}finally{o.f()}}}function be(e){for(var t=0;t<100;t++){if(!e.extendedHasPseudohinge)return e;e=e.creaseToNextAxialFacet.getOtherFace(e)}throw new Error("Caught in infinite loop while trying to find a non-pseudohinge-facet.")}function ye(e){var t=e.creaseToNextAxialFacet;if(t.creaseType!=C.Hinge)return!1;var a=t.getOtherFace(e),r=a.crossAxialOrHull;if(r.isOuterFace)throw new Error("Tried to merge MOGs across from outer face ".concat(r.nodes.map((function(e){return e.id})),", which should have been caught earlier."));var n=r.creaseToNextAxialFacet;if(n.creaseType!=C.Hinge)throw new Error("Tried to merge MOGs across from face ".concat(r.nodes.map((function(e){return e.id})),", which is not immediately before a hinge."));var o=t.from.displayId;if(o!=n.from.displayId)throw new Error("Hinge displayId mismatch: hinge ".concat(t.idString()," has displayId ").concat(t.from.displayId,", but hinge ").concat(n.idString()," has displayId ").concat(n.from.displayId));var i=r.baseFaceLocalRoot;return i.baseFaceLocalRoot==o}function we(e,t){var a,r=null,n=Object(y["a"])(e.edges.values());try{for(n.s();!(a=n.n()).done;){var o=a.value;if(o.creaseType==C.Hinge){var i,s=o.leftFace.flap,c=o.rightFace.flap,d="unset",l="unset",f="unset",u=Object(y["a"])(s);try{for(u.s();!(i=u.n()).done;){var h=i.value;c.has(h)?f=h:d=h}}catch(k){u.e(k)}finally{u.f()}var g,v=Object(y["a"])(c);try{for(v.s();!(g=v.n()).done;){var p=g.value;if(!s.has(p)){l=p;break}}}catch(k){v.e(k)}finally{v.f()}if("unset"==d||"unset"==l||"unset"==f)throw new Error("Flaps do not intersect properly at hinge ".concat(o.idString(),": leftFlap=").concat(Array.from(s),", rightFlap=").concat(Array.from(c),"."));if(f!=o.from.displayId||f!=o.to.displayId)throw new Error("Inconsistency among hinge/flap ids at hinge ".concat(o.idString(),": intersectingId=").concat(f,", from=").concat(o.from.displayId,", to=").concat(o.to.displayId,"."));var b=t.get(d),w=t.get(l),O=Math.abs(b-w);if(0==O);else{if(2!=O)throw new Error("Invalid discrete depth difference hinge ".concat(o.idString(),": node ").concat(d," has depth ").concat(b,", and node ").concat(l," has depth ").concat(w,"."));o.assignment=I.Unfolded}var m=o.baseFace;if(null==m.moleculeSource&&0==o.from.elevation){var j=o.rightFace;if(!j.hasPseudohinge){var x=m.baseFaceLocalRoot;o.from.displayId==x&&(m.moleculeSource=j,null==r&&0==t.get(f)&&(r=m))}}}}}catch(k){n.e(k)}finally{n.f()}if(null==r)throw new Error("Could not find global root hinge.");return r}function Oe(e){for(var t=e,a=[],r=!1,n=0;n<200;n++){a.push(t);var o=t.creaseToNextAxialFacet;if(t.hasPseudohinge&&(r=!0),o.assignment!=I.Unfolded){if(r){var i,s=Object(y["a"])(a);try{for(s.s();!(i=s.n()).done;){var c=i.value;c.extendedHasPseudohinge=!0}}catch(l){s.e(l)}finally{s.f()}}a=[],r=!1}var d=o.getOtherFace(t);if(d.creaseToPreviousAxialFacet=o,d==e)return;t=d}throw new Error("Caught in infinite loop while annotating extended pseudohinges.")}function me(e,t,a){for(var r=0;r<100;r++){var n=a?t.creaseToNextAxialFacet:t.creaseToPreviousAxialFacet,o=n.getOtherFace(t);if(n.assignment!=I.Unfolded||o.hasPseudohinge)return;e.addFace(o),e.addEdge(t,o),t=o;var i=t.corridor,s=i[1];if(!e.faces.has(s))for(var c=i.length,d=t,l=1;l<c;l++){var f=i[l];if(e.faces.has(f))throw new Error("Corridor (after pseudohinge) face ".concat(f.nodes.map((function(e){return e.id}))," was already visited."));e.addFace(f),e.addEdge(d,f),d=f}}throw new Error("Caught in infinite loop while annotating extended pseudohinges.")}function je(e,t,a,r,n){t.add(a);var o=a.moleculeSource;e.addFace(o),Oe(o);for(var i=be(o),s=0;s<200;s++){var c=i.corridor,d=c[1];if(!e.faces.has(d))for(var l=c.length,f=i,u=1;u<l;u++){var h=c[u];if(e.faces.has(h))throw new Error("Corridor face ".concat(h.nodes.map((function(e){return e.id}))," was already visited."));if(e.addFace(h),e.addEdge(f,h),h.hasPseudohinge&&f.hasPseudohinge){var g=h.creaseToPreviousAxialFacet==f.creaseToNextAxialFacet,v=h.creaseToNextAxialFacet==f.creaseToPreviousAxialFacet;if(g==v)throw new Error("Could not determine which way pseudohinge was crossed in going from face ".concat(f.nodes.map((function(e){return e.id}))," to face ").concat(h.nodes.map((function(e){return e.id})),"."));me(e,h,g)}f=h}var p=be(i.creaseToNextAxialFacet.getOtherFace(i));if(p.isOuterFace)throw new Error("Next face from ".concat(i.nodes.map((function(e){return e.id}))," within same molecule is outer face."));e.addFace(p);var b=i.crossAxialOrHull;if(b.isOuterFace||t.has(b.baseFaceLocalRoot)||!ye(i)){if(p==r){if(p.isOuterFace)throw new Error("Should be merging back to old molecule, but face across axial/hull edge from ".concat(i.nodes.map((function(e){return e.id}))," is outer face."));b!=n&&e.addEdge(i,b)}else{if(null==r&&p==o)return;e.addEdge(i,p)}if(p==o)return}else e.addFace(b),e.addEdge(i,b),je(e,t,b.baseFaceLocalRoot,b,n);i=p}throw new Error("Caught in infinite loop while building an MOG.")}function xe(e,t){if(e.state!=B.PreFacetOrdering)throw new Error("Should not be calling orderFacets from state ".concat(B[e.state],"."));var a=we(e,t),r=a.moleculeSource,n=new X,o=new Set;je(n,o,a,null,r);var i,s=0,c=Object(y["a"])(n.topologicalSort());try{for(c.s();!(i=c.n()).done;){var d=i.value;d.facetOrderIndex=s++}}catch(l){c.e(l)}finally{c.f()}if(n.faces.size!=e.faces.size-1)throw new Error("Expected to find all ".concat(e.faces.size-1," inner faces, instead found ").concat(n.faces.size,"."));pe(e,r,!0),e.state=B.FullyAssigned}function ke(e,t,a,r){var n,o='export function decodedTree() {\n  const tree = new TreeGraph();\n  tree.debugOverrideRootId = "'.concat(r,'";'),i=Object(y["a"])(e.nodes);try{for(i.s();!(n=i.n()).done;){var s=Object(w["a"])(n.value,2),c=s[0],d=s[1];o+="\n  const v".concat(c,' = new TreeNode("').concat(c,'", ').concat(d.x,", ").concat(d.y,");\n  tree.addNode(v").concat(c,");")}}catch(E){i.e(E)}finally{i.f()}var l,f=Object(y["a"])(e.edges.values());try{for(f.s();!(l=f.n()).done;){for(var u=l.value,h=0,g=0,v=[u.from.id,u.to.id];g<v.length;g++){var p=v[g],b=a.leafExtensions.get(a.nodes.get(p));if(void 0!=b){h=b;break}}o+="\n  tree.addEdge(new TreeEdge(v".concat(u.to.id,", v").concat(u.from.id,", ").concat(u.length+h,"));")}}catch(E){f.e(E)}finally{f.f()}o+="\n  return tree;\n}\n\nexport function decodedPacking() {\n  const packing = new Packing();\n  packing.scaleFactor = ".concat(t.scaleFactor,";");var O,m=Object(y["a"])(t.nodes);try{for(m.s();!(O=m.n()).done;){var j=Object(w["a"])(O.value,2),x=j[0],k=j[1];o+='\n  packing.nodes.set("'.concat(x,'", new PackingNode("').concat(x,'", ').concat(k.x,", ").concat(k.y,"));")}}catch(E){m.e(E)}finally{m.f()}return o+="\n  return packing;\n}",o}function Ee(e,t){if(t)switch(e.assignment){case I.Mountain:return"#ee6666";case I.Valley:return"#0021e6";case I.Unfolded:return"#ccffcc";case I.Boundary:return"#333333";case I.Unknown:return"#ffb000"}else switch(e.creaseType){case C.Ridge:return"#ee6666";case C.Gusset:return"#0021e6";case C.Pseudohinge:return"#419cc3";case C.Hinge:return"#7744a6";case C.Axial:return"#333333";case C.ActiveHull:return"#333333";case C.InactiveHull:return"#333333"}}var Pe=function(e){Object(c["a"])(a,e);var t=Object(d["a"])(a);function a(){return Object(s["a"])(this,a),t.apply(this,arguments)}return Object(v["a"])(a,[{key:"mounted",value:function(){var e=O["JSXGraph"].initBoard("creasesViewBox",{boundingbox:[-.1,1.1,1.1,-.1],showCopyright:!1});e.create("grid",[]),this.creasesBoard=e}},{key:"show",value:function(){var e=!0,t=!0,a=!0;if(!0!==this.$store.state.packingCreasesSynced){this.$store.commit("clearGlobalError");var r=O["JSXGraph"].initBoard("creasesViewBox",{boundingbox:[-.1,1.1,1.1,-.1],showCopyright:!1});r.create("grid",[]);var n=this.$store.state.treeGraph,o=this.$store.state.creasesGraph,i=n.getDistances(),s=o.findAGoodRoot(i),c=n.dangle(s),d=this.$store.state.packing;console.log(ke(n,d,o,s));try{ge(o,i,d.scaleFactor,c)}catch(A){return void this.$store.commit("updateGlobalError","Could not generate molecules. ("+A.message+")")}try{xe(o,c)}catch(A){this.$store.commit("updateGlobalError","Could not order facets. ("+A.message+")")}var l,f=new Map,u=Object(y["a"])(o.nodes.values());try{for(u.s();!(l=u.n()).done;){var h=l.value,g=a||"i"!=h.id.charAt(0)?h.displayId:"";if(h.id==h.displayId){var v=r.create("point",[h.x,h.y],{name:g,fixed:!0,highlight:!1,label:{offset:[6,6],highlight:!1}});f.set(h,v)}else{var p=r.create("point",[h.x,h.y],{name:g,fixed:!0,size:0,highlight:!1,label:{offset:[0,0],highlight:!1}});f.set(h,p)}}}catch(A){u.e(A)}finally{u.f()}var b,w=Object(y["a"])(o.edges.values());try{for(w.s();!(b=w.n()).done;){var m=b.value,j=m.to,x=m.from,k=f.get(j),E=f.get(x),P=Ee(m,t);r.create("segment",[k,E],{strokeColor:P,strokeWidth:2,highlight:!1})}}catch(A){w.e(A)}finally{w.f()}if(e){var F=Array.from(o.faces).sort((function(e,t){return e.facetOrderIndex-t.facetOrderIndex}));F.shift();var M,S=null,C=Object(y["a"])(F);try{for(C.s();!(M=C.n()).done;){var I=M.value;if(I.facetOrderIndex>=0)if(null==S)S=r.create("point",[I.averageX(),I.averageY()],{name:"",strokeColor:"#ff00e6",fillColor:"#ff00e6",fixed:!0,highlight:!1});else{var T=r.create("point",[I.averageX(),I.averageY()],{name:"",fixed:!0,size:0,highlight:!1});r.create("segment",[S,T],{strokeColor:"#ff00e6",strokeWidth:1,highlight:!1}),S=T}else r.create("point",[I.averageX(),I.averageY()],{name:"",strokeColor:"#ff00e6",fillColor:"#ff00e6",fixed:!0,highlight:!1})}}catch(A){C.e(A)}finally{C.f()}}this.creasesBoard=r,this.fold=ae(o),this.$store.commit("sync")}}},{key:"download",value:function(){if(void 0!==this.fold){var e=new Blob([JSON.stringify(this.fold)],{type:"application.json;charset=utf-8"});Object(ee["saveAs"])(e,"treefaker.fold")}}},{key:"origamiSimulator",value:function(){if(void 0!==this.fold)if(null===this.simulator||void 0===this.simulator||this.simulator.closed){this.simulator=window.open("https://origamisimulator.org/?model=treefaker");var e=this.fold,t=this.simulator;window.addEventListener("message",(function(a){null!==t&&a.source===t&&a.data&&"OrigamiSimulator"===a.data.from&&"ready"===a.data.status&&t.postMessage({op:"importFold",fold:e},"*")}))}else this.simulator.focus(),this.simulator.postMessage({op:"importFold",fold:this.fold},"*")}}]),a}(f["b"]);Pe=Object(l["a"])([f["a"]],Pe);var Fe=Pe,Me=Fe,Se=Object(J["a"])(Me,Z,Q,!1,null,null,null),Ce=Se.exports,Ie=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"viewBox",attrs:{id:"packingViewBox"}})},Te=[],Ae=a("53ca"),_e=a("7909"),Ne=(a("cb29"),2);function Ue(e,t){return function(a){return a[e]<t?t-a[e]:0}}function Re(e,t,a){return function(r){var n=Object(_e["s"])([a]);return r[e]<t&&(n[e]=-1),n}}function Ge(e,t){return function(a){return a[e]>t?a[e]-t:0}}function Be(e,t,a){return function(r){var n=Object(_e["s"])([a]);return r[e]>t&&(n[e]=1),n}}function He(e,t,a){var r=Object(_e["p"])(e)[0],n=e[t][a];return function(e){var o=e[2*r],i=Math.sqrt(Math.pow(e[t]-e[a],2)+Math.pow(e[t+r]-e[a+r],2)),s=o*n;return s-i}}function Le(e,t,a){var r=Object(_e["p"])(e)[0],n=e[t][a];return function(e){var o=Math.sqrt(Math.pow(e[t]-e[a],2)+Math.pow(e[t+r]-e[a+r],2)),i=1/o,s=Object(_e["s"])([2*r+1]);return s[t]=i*(e[a]-e[t]),s[a]=i*(e[t]-e[a]),s[t+r]=i*(e[a+r]-e[t+r]),s[a+r]=i*(e[t+r]-e[a+r]),s[2*r]=n,s}}function Xe(e){for(var t=Object(_e["p"])(e)[0],a=Array(2*t).fill(null).map((function(e,t){return Ue(t,0)})),r=Array(2*t).fill(null).map((function(e,t){return Ge(t,1)})),n=[],o=0;o<t;o++)for(var i=o+1;i<t;i++)n.push(He(e,o,i));return[Ue(2*t,0),Ge(2*t,Ne)].concat(Object(re["a"])(a),Object(re["a"])(r),n)}function De(e){for(var t=Object(_e["p"])(e)[0],a=Array(2*t).fill(null).map((function(e,a){return Re(a,0,2*t+1)})),r=Array(2*t).fill(null).map((function(e,a){return Be(a,1,2*t+1)})),n=[],o=0;o<t;o++)for(var i=o+1;i<t;i++)n.push(Le(e,o,i));return[Re(2*t,0,2*t+1),Be(2*t,Ne,2*t+1)].concat(Object(re["a"])(a),Object(re["a"])(r),n)}function $e(e){for(var t=Array.from(e.keys()).sort(),a=t.length,r=Object(_e["s"])([a,a]),n=0;n<a;n++)for(var o=t[n],i=0;i<a;i++){var s=t[i];if(n!==i){var c,d=null===(c=e.get(o))||void 0===c?void 0:c.get(s);r[n][i]=d[d.length-1][1]}}return r}a("4de4"),a("35b3");var ze=10,Ve=10,qe=1e8,Ye=50,Je=100,Ke=1e-4,We=Number.EPSILON,Ze=4*We,Qe=1e-5;function et(e){var t=(Object(_e["p"])(e)-1)/2;return Math.sqrt(2*t)}function tt(e,t,a,r){var n,o=(Object(_e["p"])(e)-1)/2,i=-e[2*o],s=Object(y["a"])(t.constraints.entries());try{for(s.s();!(n=s.n()).done;){var c=Object(w["a"])(n.value,2),d=c[0],l=c[1],f=a[d],u=l(e),h=-.5*f/r;i+=u<h?h:(f+u*r)*u}}catch(g){s.e(g)}finally{s.f()}return i}function at(e,t,a,r){var n=(Object(_e["p"])(e)-1)/2,o=Object(_e["s"])([2*n+1]);o[2*n]=-1;var i,s=Object(y["a"])(t.constraints.entries());try{for(s.s();!(i=s.n()).done;){var c=Object(w["a"])(i.value,2),d=c[0],l=c[1],f=a[d],u=l(e),h=-.5*f/r;if(u>=h){var g=f+2*u*r;if(Math.abs(g)>Ze){var v=t.grad[d],p=v(e);o=Object(_e["b"])(o,Object(_e["k"])(g,p))}}}}catch(b){s.e(b)}finally{s.f()}return o}function rt(e,t,a,r){var n,o=Object(_e["c"])(a),i=Object(y["a"])(t.constraints.entries());try{for(i.s();!(n=i.n()).done;){var s=Object(w["a"])(n.value,2),c=s[0],d=s[1],l=d(e),f=-.5*a[c]/r;l<f?o[c]=0:o[c]+=2*r*l}}catch(u){i.e(u)}finally{i.f()}return o}function nt(e,t){if(1===Object(_e["p"])(e).length&&1===Object(_e["p"])(t).length){for(var a=Object(_e["p"])(e)[0],r=Object(_e["p"])(t)[0],n=Object(_e["m"])([a,r]),o=0;o<a;o++)for(var i=0;i<r;i++)n[o][i]=e[o]*t[i];return n}}function ot(e,t,a,r,n){var o=Object(_e["l"])(t),i=1,s=et(e.X);o>s&&(i=s/o);var c=Object(_e["e"])(e.grad,Object(_e["k"])(i,t));if(c>=0)return e;var d=We/Object(_e["i"])(Object(_e["f"])(Object(_e["a"])(t),Object(_e["i"])([Object(_e["a"])(e.X),Object(_e["m"])([Object(_e["p"])(e.X)[0]])],0)),0),l=1,f=0,u=0,h=e.X;while(1){var g=Object(_e["b"])(e.X,Object(_e["k"])(i*l,t)),v=tt(g,a,r,n),p=u+Ke*l*c;if(l<d)break;if(v<=p)return{X:g,f:v,grad:at(g,a,r,n)};var b=void 0;if(1===l)b=-c/(2*(v-e.f-c));else{var y=v-e.f-l*c,w=u-e.f-f*c,O=Math.pow(l,2),m=Math.pow(f,2),j=l-f,x=(y/O-w/m)/j,k=(-f*y/O+l*w/m)/j;if(0===x)b=-c/(2*k);else{var E=Math.pow(k,2)-3*x*c;b=E<0?l/2:k<=0?(-k+Math.sqrt(E))/(3*x):-c/(k+Math.sqrt(E)),b=Math.min(b,l/2)}}f=l,u=v,h=g,l=Math.max(b,l/10)}return{X:h,f:u,grad:at(h,a,r,n)}}function it(e,t,a,r){for(var n=e,o=Object(_e["k"])(-1,at(e.X,t,a,r)),i=Object(_e["d"])(Object(_e["m"])([Object(_e["p"])(e.grad)[0]])),s=1;s<=Je;s++){var c=ot(n,o,t,a,r);if(void 0===c)return;o=Object(_e["r"])(c.X,n.X);var d=Object(_e["i"])(Object(_e["f"])(Object(_e["a"])(o),Object(_e["i"])([Object(_e["a"])(c.X),Object(_e["m"])([Object(_e["p"])(c.X)[0]])],0)));if(d<Ze)break;var l=Object(_e["i"])(Object(_e["k"])(Object(_e["a"])(c.grad),Object(_e["i"])([Object(_e["a"])(c.X),Object(_e["m"])([Object(_e["p"])(c.X)[0]])],0)))/Math.max(c.f,1);if(l<Qe)break;var f=Object(_e["r"])(c.grad,n.grad),u=Object(_e["k"])(i,f),h=Object(_e["e"])(f,o),g=Object(_e["e"])(f,u),v=Math.pow(Object(_e["l"])(f),2),p=Math.pow(Object(_e["l"])(o),2);if(h>Math.sqrt(We*v*p)){var b=1/h,y=1/g,w=Object(_e["r"])(Object(_e["k"])(b,o),Object(_e["k"])(y,u)),O=Object(_e["r"])(Object(_e["b"])(Object(_e["k"])(b,nt(o,o)),Object(_e["k"])(g,nt(w,w))),Object(_e["k"])(y,nt(u,u)));i=Object(_e["b"])(i,O)}o=Object(_e["k"])(i,Object(_e["k"])(-1,c.grad)),n=c}return n}function st(e,t,a){for(var r=a.constraints.length,n=Object(_e["s"])([r]),o=ze,i={X:e,f:tt(e,a,n,o),grad:at(e,a,n,o)},s=0,c=void 0,d=function(e){var t=it(i,a,n,o);if(void 0===t)return{v:void 0};var r=t,d=Object(_e["i"])(Object(_e["i"])(a.constraints.map((function(e){return e(r.X)}))),0);n=rt(r.X,a,n,o);var l=-r.X[Object(_e["p"])(r.X)[0]-1];e>0&&d<Qe&&s>l&&(c=r.X,s=l),o=Math.min(o*Ve,qe),i=r},l=0;l<Ye;l++){var f=d(l);if("object"===Object(Ae["a"])(f))return f.v}return c}var ct=function(e){Object(c["a"])(a,e);var t=Object(d["a"])(a);function a(){var e;return Object(s["a"])(this,a),e=t.call(this),e.packingBoard=null,e}return Object(v["a"])(a,[{key:"clear",value:function(){var e=O["JSXGraph"].initBoard("packingViewBox",{boundingbox:[-.05,1.05,1.05,-.05],showCopyright:!1,showNavigation:!1});e.create("grid",[]),this.packingBoard=e}},{key:"mounted",value:function(){this.clear()}},{key:"pack",value:function(){var e=Object(g["a"])(regeneratorRuntime.mark((function e(){var t,a,r,n,o,i,s,c,d,l=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.$store.commit("clearGlobalError"),this.clear(),t=.001,a=this.$store.state.treeGraph,r=new Map,a.nodes.forEach((function(e,t){1===e.edges.length&&r.set(t,e.edges[0].length)})),n=a.getDistances(),n.size!==a.nodes.size){e.next=10;break}return this.$store.commit("updateGlobalError","Add at least one non-leaf vertex to the tree."),e.abrupt("return");case 10:return o=$e(n),i=Object(_e["p"])(o)[0],s=Object(_e["s"])([2*i+1]),c=Array.from(n.keys()).sort(),d=this.$store.state.treeGraph.nodes,c.forEach((function(e,t){s[t]=d.get(e).x,s[t+i]=d.get(e).y})),e.abrupt("return",new Promise((function(e){for(var a=!0,d="Did not update error message.",f=function(e){for(var f=void 0,u=0;u<6&&void 0===f;u++){var h=Object(_e["b"])(o,Object(_e["k"])(t,Object(_e["n"])(Object(_e["p"])(o)))),g={constraints:Xe(h),grad:De(h)},v=Object(_e["b"])(s,Object(_e["k"])(t,Object(_e["n"])(Object(_e["p"])(s))));f=st(v,h,g)}if(void 0===f)return l.$store.commit("updateGlobalError","Could not generate disk packing from tree."),{v:void 0};var p=new R;p.scaleFactor=f[2*i];for(var b=0;b<i;b++){var y=c[b],w=f[b],m=f[b+i];p.nodes.set(y,new U(y,w,m))}var j=null;try{j=ce(p,n)}catch(P){return l.$store.commit("updateGlobalError","Could not clean packing. '"+P.message+"'"),{v:void 0}}try{var x=le(j);if(null!=x)return d=x,"continue"}catch(P){return l.$store.commit("updateGlobalError","Could not build faces: '"+P.message+"'"),{v:void 0}}if(fe(n,j))return d="Tree is twisted.","continue";a=!1,l.$store.commit("updatePacking",p),l.$store.commit("updateCreasesGraph",j),l.$store.commit("unsync");var k=l.$store.state.creasesGraph,E=O["JSXGraph"].initBoard("packingViewBox",{boundingbox:[-.1,1.1,1.1,-.1],showCopyright:!1,showNavigation:!1});E.create("grid",[]),k.nodes.forEach((function(e){var t=E.create("point",[e.x,e.y],{name:e.id,label:{offset:[6,6],highlight:!1},highlight:!1,fixed:!0}),a=(r.get(e.id)+k.leafExtensions.get(e))*p.scaleFactor;E.create("circle",[t,a],{fixed:!0,strokeColor:"#0021e6",highlight:!1})})),l.packingBoard=E},u=0;a&&u<6;u++){var h=f(u);if("continue"!==h&&"object"===Object(Ae["a"])(h))return h.v}a&&l.$store.commit("updateGlobalError","Could not find packing. Error message from final attempt: '"+d+"'"),e(1)})));case 17:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),a}(f["b"]);ct=Object(l["a"])([f["a"]],ct);var dt=ct,lt=dt,ft=Object(J["a"])(lt,Ie,Te,!1,null,null,null),ut=ft.exports,ht=a("5fda"),gt=a("1947"),vt=a("01e3"),pt=a("dbbe"),bt=a("f9bc");f["b"].component("b-alert",ht["a"]),f["b"].component("b-button",gt["a"]),f["b"].component("b-spinner",vt["a"]),f["b"].use(pt["a"]),f["b"].use(bt["a"]);var yt=function(e){Object(c["a"])(a,e);var t=Object(d["a"])(a);function a(){var e;return Object(s["a"])(this,a),e=t.apply(this,arguments),e.generatingPacking=!1,e}return Object(v["a"])(a,[{key:"generatePacking",value:function(){var e=Object(g["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.$refs.tree.propagate(),e.next=3,this.$refs.packing.pack();case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getCreasePattern",value:function(){this.$refs.creases.show()}},{key:"exportFold",value:function(){this.$refs.creases.download()}},{key:"origamiSimulator",value:function(){this.$refs.creases.origamiSimulator()}},{key:"creasesDisabled",get:function(){return void 0===this.$store.state.creasesGraph}},{key:"exportDisabled",get:function(){return!1}},{key:"inErrorState",get:function(){return void 0!==this.$store.state.globalError}},{key:"errorMessage",get:function(){return this.$store.state.globalError}}]),a}(f["b"]);yt=Object(l["a"])([Object(f["a"])({components:{TreeView:W,CreasesView:Ce,PackingView:ut}})],yt);var wt=yt,Ot=wt,mt=Object(J["a"])(Ot,u,h,!1,null,null,null),jt=mt.exports,xt=a("5f5b");f["b"].use(xt["a"]);var kt=function(e){Object(c["a"])(a,e);var t=Object(d["a"])(a);function a(){return Object(s["a"])(this,a),t.apply(this,arguments)}return a}(f["b"]);kt=Object(l["a"])([Object(f["a"])({components:{TreeFaker:jt}})],kt);var Et=kt,Pt=Et,Ft=Object(J["a"])(Pt,o,i,!1,null,null,null),Mt=Ft.exports;a("d550"),a("e88e"),a("d860"),a("f9e3"),a("2dd8"),a("6672");r["default"].use(n["a"]),r["default"].config.productionTip=!1;var St={state:{treeGraph:void 0,creasesGraph:void 0,packing:void 0,globalError:void 0,packingCreasesSynced:!1},mutations:{updateTreeGraph:function(e,t){e.treeGraph=t},updateCreasesGraph:function(e,t){e.creasesGraph=t},updatePacking:function(e,t){e.packing=t},updateGlobalError:function(e,t){e.globalError=t},clearGlobalError:function(e){e.globalError=void 0},unsync:function(e){e.packingCreasesSynced=!1},sync:function(e){e.packingCreasesSynced=!0}}},Ct=new n["a"].Store(St);new r["default"]({render:function(e){return e(Mt)},store:Ct}).$mount("#app")},d550:function(e,t,a){},d860:function(e,t,a){},e88e:function(e,t,a){}});
//# sourceMappingURL=app.f26b3fe2.js.map